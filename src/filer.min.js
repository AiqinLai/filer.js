var self=this;self.URL=self.URL||self.webkitURL;self.requestFileSystem=self.requestFileSystem||self.webkitRequestFileSystem;self.resolveLocalFileSystemURL=self.resolveLocalFileSystemURL||self.webkitResolveLocalFileSystemURL;self.BlobBuilder=self.BlobBuilder||self.MozBlobBuilder||self.WebKitBlobBuilder;
var Utils={toArray:function(b){return Array.prototype.slice.call(b||[],0)},toDataURL:function(b,d,c){return(void 0!=c?c:1)?"data:"+d+";base64,"+self.btoa(b):"data:"+d+","+b},strToObjectURL:function(b,d){for(var c=new Uint8Array(b.length),e=0;e<c.length;++e)c[e]=b.charCodeAt(e);e=new BlobBuilder;e.append(c.buffer);c=d?e.getBlob(d):e.getBlob();return self.URL.createObjectURL(c)},fileToObjectURL:function(b){return self.URL.createObjectURL(b)},arrayToBinaryString:function(b){if("object"!=typeof b)return null;
for(var d=b.length,c=Array(d);d--;)c[d]=String.fromCharCode(b[d]);return c.join("")}},MyFileError=function(b){this.prototype=FileError.prototype;this.code=b.code;this.name=b.name};FileError.BROWSER_NOT_SUPPORTED=1E3;FileError.prototype.__defineGetter__("name",function(){for(var b=Object.keys(FileError),d=0,c;c=b[d];++d)if(FileError[c]==this.code)return c;return"Unknown Error"});
var Filer=new function(){function b(a){if(d=a||null)c=d.root,e=!0,i=d.root.toURL()}var d=null,c=null,e=!1,i=null,j=function(a){0==a.indexOf("filesystem:")||(a="/"==a[0]?i+a:0==a.indexOf("./")||0==a.indexOf("../")?c.toURL()+"/"+a:c.toURL()+a);return a},k=function(a,m){var c=arguments[1],b=arguments[2],d=function(a){if(a.code==FileError.NOT_FOUND_ERR){if(b)throw Error('"'+c+'" or "'+b+'" does not exist.');throw Error('"'+c+'" does not exist.');}throw Error("Problem getting Entry for one or more paths.");
},h=j(c);if(3==arguments.length){var e=j(b);self.resolveLocalFileSystemURL(h,function(c){self.resolveLocalFileSystemURL(e,function(b){a(c,b)},d)},d)}else self.resolveLocalFileSystemURL(h,a,d)};b.DEFAULT_FS_SIZE=1048576;b.prototype={get fs(){return d},get isOpen(){return e}};b.prototype.init=function(a,b,g){if(!self.requestFileSystem)throw new MyFileError({code:FileError.BROWSER_NOT_SUPPORTED,name:"BROWSER_NOT_SUPPORTED"});initObj=!a?{}:a;var f=initObj.size||1048576;this.type=self.TEMPORARY;if("persistent"in
initObj&&initObj.persistent)this.type=self.PERSISTENT;self.requestFileSystem(this.type,f,function(a){this.size=f;d=a;c=d.root;e=!0;i=d.root.toURL();b&&b(a)}.bind(this),g)};b.prototype.ls=function(a,b,g){if(!d)throw Error("Filesystem has not been initialized.");var f=function(a){c=a;var d=[],f=c.createReader(),e=function(){f.readEntries(function(a){a.length?(d=d.concat(Utils.toArray(a)),e()):(d.sort(function(a,b){return a.name<b.name?-1:b.name<a.name?1:0}),b(d))},g)};e()};a.isDirectory?f(a):c.getDirectory(a,
{},f,g)};b.prototype.mkdir=function(a,b,g,f){if(!d)throw Error("Filesystem has not been initialized.");c.getDirectory(a,{create:!0,exclusive:null!=b?b:!0},function(b){if(b.isDirectory)g(b);else throw Error(a+" is not a directory");},function(b){if(b.code==FileError.INVALID_MODIFICATION_ERR)if(f)f(b);else throw Error("'"+a+"' already exists");})};b.prototype.open=function(a,b,g){if(!d)throw Error("Filesystem has not been initialized.");c.getFile(a,{},function(a){b?a.file(function(a){b(a)},g):self.open(a.toURL(),
"fileWin")},g)};b.prototype.create=function(a,b,g,f){if(!d)throw Error("Filesystem has not been initialized.");c.getFile(a,{create:!0,exclusive:null!=b?b:!0},g,function(b){if(b.code==FileError.INVALID_MODIFICATION_ERR)throw f&&f(b),Error("'"+a+"' already exists");})};b.prototype.rename=function(a,b,d,f){if(!(a.name==b||a==b)){var e=function(d,c){if(d.code==FileError.NOT_FOUND_ERR)throw Error('"'+a+'" does not exist.');if(d.code==FileError.INVALID_MODIFICATION_ERR)throw Error('"'+b+'" already exists.');
c&&c(d)};a.isFile||a.isDirectory?a.moveTo(c,b,d,function(a){e(a,f)}):k(function(a){a.moveTo(c,b,d,function(a){e(a,f)})},a)}};b.prototype.rm=function(a,b,c){if(!d)throw Error("Filesystem has not been initialized.");a.isFile?a.remove(b,c):a.isDirectory&&a.removeRecursively(b,c)};b.prototype.cd=function(a,b,e){if(!d)throw Error("Filesystem has not been initialized.");a.isDirectory?(c=a,b&&b(c)):self.resolveLocalFileSystemURL(j(a),function(a){if(a.isDirectory)c=a,b&&b(c);else throw Error("Path was not a directory.");
},e)};b.prototype.cp=function(a,b,c,e,l){if(!d)throw Error("Filesystem has not been initialized.");var h=c||null;!a.isFile&&!a.isDirectory&&k(function(b,a){if(!a.isDirectory)throw Error('Oops! "'+a.name+" is not a directory!");b.copyTo(a,h,e,l)},a,b)};b.prototype.write=function(a,b,e,f){if(!d)throw Error("Filesystem has not been initialized.");c.getFile(a,{create:!0,exclusive:!1},function(a){a.createWriter(function(c){c.onwrite=function(){console.log("Write completed.")};c.onerror=function(a){console.log("Write failed: "+
a)};c.write(b.data);console.log(b,typeof b.data);e(a,c)},f)},f)};return b};
