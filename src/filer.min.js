var self=this;self.URL=self.URL||self.webkitURL;self.requestFileSystem=self.requestFileSystem||self.webkitRequestFileSystem;self.resolveLocalFileSystemURL=self.resolveLocalFileSystemURL||self.webkitResolveLocalFileSystemURL;self.BlobBuilder=self.BlobBuilder||self.MozBlobBuilder||self.WebKitBlobBuilder;
var Util={toArray:function(a){return Array.prototype.slice.call(a||[],0)},strToDataURL:function(a,c,b){return(void 0!=b?b:1)?"data:"+c+";base64,"+self.btoa(a):"data:"+c+","+a},strToObjectURL:function(a,c){for(var b=new Uint8Array(a.length),d=0;d<b.length;++d)b[d]=a.charCodeAt(d);d=new BlobBuilder;d.append(b.buffer);b=c?d.getBlob(c):d.getBlob();return self.URL.createObjectURL(b)},fileToObjectURL:function(a){return self.URL.createObjectURL(a)},fileToArrayBuffer:function(a,c,b){var d=new FileReader;
d.onload=function(a){c(a.target.result)};d.onerror=function(a){b&&b(a)};d.readAsArrayBuffer(a)},arrayBufferToBlob:function(a,c){var b=new BlobBuilder;b.append(a);return c?b.getBlob(c):b.getBlob()},arrayBufferToBinaryString:function(a,c,b){var d=new FileReader;d.onload=function(a){c(a.target.result)};d.onerror=function(a){b&&b(a)};var i=new BlobBuilder;i.append(a);d.readAsBinaryString(i.getBlob())},arrayToBinaryString:function(a){if("object"!=typeof a)return null;for(var c=a.length,b=Array(c);c--;)b[c]=
String.fromCharCode(a[c]);return b.join("")},getFileExtension:function(a){return a.substring(a.lastIndexOf("."))}},MyFileError=function(a){this.prototype=FileError.prototype;this.code=a.code;this.name=a.name};FileError.BROWSER_NOT_SUPPORTED=1E3;FileError.prototype.__defineGetter__("name",function(){for(var a=Object.keys(FileError),c=0,b;b=a[c];++c)if(FileError[b]==this.code)return b;return"Unknown Error"});
var Filer=new function(){function a(e){if(c=e||null)b=c.root,d=!0,i=c.root.toURL()}var c=null,b=null,d=!1,i=null,j=function(e){0==e.indexOf("filesystem:")||(e="/"==e[0]?i+e.substring(1):0==e.indexOf("./")||0==e.indexOf("../")?b.toURL()+"/"+e:b.toURL()+e);return e},l=function(e,a){var b=arguments[1],f=arguments[2],h=function(e){if(e.code==FileError.NOT_FOUND_ERR){if(f)throw Error('"'+b+'" or "'+f+'" does not exist.');throw Error('"'+b+'" does not exist.');}throw Error("Problem getting Entry for one or more paths.");
},c=j(b);if(3==arguments.length){var d=j(f);self.resolveLocalFileSystemURL(c,function(a){self.resolveLocalFileSystemURL(d,function(b){e(a,b)},h)},h)}else self.resolveLocalFileSystemURL(c,e,h)};a.DEFAULT_FS_SIZE=1048576;a.prototype={get fs(){return c},get isOpen(){return d}};a.prototype.pathToFilesystemURL=function(e){return j(e)};a.prototype.init=function(e,a,g){if(!self.requestFileSystem)throw new MyFileError({code:FileError.BROWSER_NOT_SUPPORTED,name:"BROWSER_NOT_SUPPORTED"});var e=e?e:{},f=e.size||
1048576;this.type=self.TEMPORARY;if("persistent"in e&&e.persistent)this.type=self.PERSISTENT;self.requestFileSystem(this.type,f,function(e){this.size=f;c=e;b=c.root;d=!0;i=c.root.toURL();a&&a(e)}.bind(this),g)};a.prototype.ls=function(e,a,g){if(!c)throw Error("Filesystem has not been initialized.");var f=function(e){b=e;var c=[],f=b.createReader(),d=function(){f.readEntries(function(e){e.length?(c=c.concat(Util.toArray(e)),d()):(c.sort(function(e,a){return e.name<a.name?-1:a.name<e.name?1:0}),a(c))},
g)};d()};e.isDirectory?f(e):0==e.indexOf("filesystem:")?l(f,j(e)):b.getDirectory(e,{},f,g)};a.prototype.mkdir=function(e,a,d,f){if(!c)throw Error("Filesystem has not been initialized.");var h=null!=a?a:!1,k=e.split("/"),i=function(a,b){if("."==b[0]||""==b[0])b=b.slice(1);a.getDirectory(b[0],{create:!0,exclusive:h},function(a){if(a.isDirectory)b.length&&1!=k.length?i(a,b.slice(1)):d(a);else if(a=Error(e+" is not a directory"),f)f(a);else throw a;},function(a){if(a.code==FileError.INVALID_MODIFICATION_ERR)if(a.message=
"'"+e+"' already exists",f)f(a);else throw a;})};i(b,k)};a.prototype.open=function(a,d,g){if(!c)throw Error("Filesystem has not been initialized.");b.getFile(a,{},function(a){d?a.file(function(a){d(a)},g):self.open(a.toURL(),"fileWin")},g)};a.prototype.create=function(a,d,g,f){if(!c)throw Error("Filesystem has not been initialized.");b.getFile(a,{create:!0,exclusive:null!=d?d:!0},g,function(b){if(b.code==FileError.INVALID_MODIFICATION_ERR)b.message="'"+a+"' already exists";if(f)f(b);else throw b;
})};a.prototype.rename=function(a,c,d,f){a.name==c||a==c||(a.isFile||a.isDirectory)&&a.moveTo(b,c,d,function(a){if(a.code==FileError.NOT_FOUND_ERR)a.message=Error('"'+entry+'" does not exist.');else if(a.code==FileError.INVALID_MODIFICATION_ERR)a.message=Error('"'+c+'" already exists.');if(f)f(a);else throw a;})};a.prototype.rm=function(a,b,d){if(!c)throw Error("Filesystem has not been initialized.");var f=function(a){a.isFile?a.remove(b,d):a.isDirectory&&a.removeRecursively(b,d)};a.isFile||a.isDirectory?
f(a):l(f,a)};a.prototype.cd=function(a,d,g){if(!c)throw Error("Filesystem has not been initialized.");a.isDirectory?(b=a,d&&d(b)):(a=j(a),l(function(a){if(a.isDirectory)b=a,d&&d(b);else if(a=Error("Path was not a directory."),g)g(a);else throw a;},a))};a.prototype.cp=function(a,b,d,f,h){if(!c)throw Error("Filesystem has not been initialized.");var k=d||null;(a.isFile||b.isDirectory)&&b.isDirectory?a.copyTo(b,k,f,h):l(function(a,b){if(b.isDirectory)a.copyTo(b,k,f,h);else{var c=Error('Oops! "'+b.name+
" is not a directory!");if(h)h(c);else throw c;}},a,b)};a.prototype.write=function(a,d,g,f){if(!c)throw Error("Filesystem has not been initialized.");b.getFile(a,{create:!0,exclusive:!1},function(a){a.createWriter(function(b){b.onwrite=function(){console.log("Write completed.")};b.onerror=function(a){console.log("Write failed: "+a)};b.write(d.data);console.log(d,typeof d.data);g(a,b)},f)},f)};return a};
