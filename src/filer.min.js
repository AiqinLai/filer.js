var self=this;self.URL=self.URL||self.webkitURL;self.requestFileSystem=self.requestFileSystem||self.webkitRequestFileSystem;self.resolveLocalFileSystemURL=self.resolveLocalFileSystemURL||self.webkitResolveLocalFileSystemURL;self.BlobBuilder=self.BlobBuilder||self.MozBlobBuilder||self.WebKitBlobBuilder;
var Utils={toArray:function(a){return Array.prototype.slice.call(a||[],0)},toDataURL:function(a,b,c){return(void 0!=c?c:1)?"data:"+b+";base64,"+self.btoa(a):"data:"+b+","+a},strToObjectURL:function(a,b){for(var c=new Uint8Array(a.length),e=0;e<c.length;++e)c[e]=a.charCodeAt(e);e=new BlobBuilder;e.append(c.buffer);c=b?e.getBlob(b):e.getBlob();return self.URL.createObjectURL(c)},fileToObjectURL:function(a){return self.URL.createObjectURL(a)},arrayToBinaryString:function(a){if("object"!=typeof a)return null;
for(var b=a.length,c=Array(b);b--;)c[b]=String.fromCharCode(a[b]);return c.join("")}},MyFileError=function(a){this.prototype=FileError.prototype;this.code=a.code;this.name=a.name};FileError.BROWSER_NOT_SUPPORTED=1E3;FileError.prototype.__defineGetter__("name",function(){for(var a=Object.keys(FileError),b=0,c;c=a[b];++b)if(FileError[c]==this.code)return c;return"Unknown Error"});
var Filer=new function(){function a(d){if(b=d||null)c=b.root,e=!0,j=b.root.toURL()}var b=null,c=null,e=!1,j=null,l=function(d,h){0==h.indexOf("filesystem:")||(h="/"!=h[0]?d.toURL()+"/"+h:j+h);return h},m=function(d,h){var a=arguments[1],b=arguments[2],k=function(d){if(d.code==FileError.NOT_FOUND_ERR){if(b)throw Error('"'+a+'" or "'+b+'" does not exist.');throw Error('"'+a+'" does not exist.');}throw Error("Problem getting Entry for one or more paths.");},i=l(c,a);if(3==arguments.length){var e=l(c,
b);self.resolveLocalFileSystemURL(i,function(a){self.resolveLocalFileSystemURL(e,function(h){d(a,h)},k)},k)}else self.resolveLocalFileSystemURL(i,d,k)};a.DEFAULT_FS_SIZE=1048576;a.prototype={get fs(){return b},get isOpen(){return e}};a.prototype.init=function(d,a,f){if(!self.requestFileSystem)throw new MyFileError({code:FileError.BROWSER_NOT_SUPPORTED,name:"BROWSER_NOT_SUPPORTED"});initObj=!d?{}:d;var g=initObj.size||1048576;this.type=self.TEMPORARY;if("persistent"in initObj&&initObj.persistent)this.type=
self.PERSISTENT;self.requestFileSystem(this.type,g,function(d){this.size=g;b=d;c=b.root;e=!0;j=b.root.toURL();a&&a(d)}.bind(this),f)};a.prototype.ls=function(d,a,f){if(!b)throw Error("Filesystem has not been initialized.");var g=function(d){c=d;var b=[],g=c.createReader(),e=function(){g.readEntries(function(d){d.length?(b=b.concat(Utils.toArray(d)),e()):(b.sort(function(d,a){return d.name<a.name?-1:a.name<d.name?1:0}),a(b))},f)};e()};d.isDirectory?g(d):c.getDirectory(d,{},g,f)};a.prototype.mkdir=
function(d,a,f,g){if(!b)throw Error("Filesystem has not been initialized.");c.getDirectory(d,{create:!0,exclusive:null!=a?a:!0},function(a){if(a.isDirectory)f(a);else throw Error(d+" is not a directory");},function(a){if(a.code==FileError.INVALID_MODIFICATION_ERR)if(g)g(a);else throw Error("'"+d+"' already exists");})};a.prototype.open=function(a,h,f){if(!b)throw Error("Filesystem has not been initialized.");c.getFile(a,{},function(a){h?a.file(function(a){h(a)},f):self.open(a.toURL(),"fileWin")},
f)};a.prototype.create=function(a,h,f,g){if(!b)throw Error("Filesystem has not been initialized.");c.getFile(a,{create:!0,exclusive:null!=h?h:!0},f,function(b){if(b.code==FileError.INVALID_MODIFICATION_ERR)throw g&&g(b),Error("'"+a+"' already exists");})};a.prototype.rename=function(a,b,f,g){if(!(a.name==b||a==b)){var e=function(c,f){if(c.code==FileError.NOT_FOUND_ERR)throw Error('"'+a+'" does not exist.');if(c.code==FileError.INVALID_MODIFICATION_ERR)throw Error('"'+b+'" already exists.');f&&f(c)};
a.isFile||a.isDirectory?a.moveTo(c,b,f,function(a){e(a,g)}):m(function(a){a.moveTo(c,b,f,function(a){e(a,g)})},a)}};a.prototype.rm=function(a,c,f){if(!b)throw Error("Filesystem has not been initialized.");a.isFile?a.remove(c,f):a.isDirectory&&a.removeRecursively(c,f)};a.prototype.cd=function(){if(!b)throw Error("Filesystem has not been initialized.");throw Error("Not implemented.");};a.prototype.cp=function(a,c,f,g,e){if(!b)throw Error("Filesystem has not been initialized.");var i=f||null;!a.isFile&&
!a.isDirectory&&m(function(a,b){if(!b.isDirectory)throw Error('Oops! "'+b.name+" is not a directory!");a.copyTo(b,i,g,e)},a,c)};a.prototype.write=function(a,e,f,g){if(!b)throw Error("Filesystem has not been initialized.");c.getFile(a,{create:!0,exclusive:!1},function(a){a.createWriter(function(b){b.onwrite=function(){console.log("Write completed.")};b.onerror=function(a){console.log("Write failed: "+a)};b.write(e.data);console.log(e,typeof e.data);f(a,b)},g)},g)};return a};
